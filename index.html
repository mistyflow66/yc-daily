<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dashboard.exe</title>
    <link rel="icon" type="image/webp" href="icon.webp">
    <link rel="apple-touch-icon" href="icon.webp">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@500;700&display=swap');
        :root {
            --bg: #0E0B14; --surface: #181225;
            --primary: #7B3DFF; --secondary: #FF6A3D;
            --accent-yellow: #FFC247; --accent-green: #2BCB7D;
            --accent-pink: #E5A3C7; --accent-blue: #3D57FF;
            --text: #F3F0FF; --text-muted: #B8AFCF;
        }
        body { 
            background-color: var(--bg); 
            color: var(--text); 
            font-family: sans-serif;
            position: relative;
            overflow-x: hidden;
        }
        /* ÂãïÊÖãÂô™ÈªûÊïàÊûú Grainy Effect */
        body::before {
            content: "";
            position: fixed;
            top: -100%; left: -100%; width: 300%; height: 300%;
            pointer-events: none;
            z-index: 50;
            opacity: 0.06;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
            animation: grain 8s steps(10) infinite;
        }
        @keyframes grain {
            0%, 100% { transform: translate(0, 0); }
            10% { transform: translate(-5%, -10%); }
            30% { transform: translate(-10%, 5%); }
            50% { transform: translate(5%, -5%); }
            70% { transform: translate(10%, 10%); }
            90% { transform: translate(-5%, 5%); }
        }

        /* Pixel Ë≤ìÂí™Ê®£Âºè - ÊèêÈ´ò z-index ‰∏¶ÂÑ™ÂåñÈ°ØÁ§∫ */
        #pixel-cat {
            position: fixed;
            bottom: 10px;
            left: 50%; /* ÊîπÂæû‰∏≠ÈñìÈñãÂßã */
            width: 32px;
            height: 32px;
            image-rendering: pixelated;
            cursor: pointer;
            z-index: 999; /* Á¢∫‰øùÂú®ÊúÄ‰∏äÂ±§ */
            transition: bottom 0.2s;
            /* Êèõ‰∫Ü‰∏ÄÂÄãÊõ¥Ê∏ÖÊô∞ÁöÑÁ¥îÁôΩÂÉèÁ¥†Ë≤ìÂúñÊ°à */
            background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACshzhSAAAAGFBMVEUAAAD///////////////////////////+MWny9AAAACHRSTlMAESEiM0R0p7uS7mIAAAA7SURBVCjPY2AYBaNgFIyCUUArwIwpYAcLptYpYAcLptYpYAcLptYpYAcLptYpYAcLptYpYAcLptYpYAcLpgoA0mIOf98yXpAAAAAASUVORK5CYII=') no-repeat center;
            background-size: contain;
        }
        #cat-bubble {
            position: fixed;
            bottom: 45px;
            background: white;
            color: black;
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: bold;
            display: none;
            z-index: 1000;
            pointer-events: none;
            white-space: nowrap;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }
        #cat-bubble::after {
            content: "";
            position: absolute;
            bottom: -5px; left: 10px;
            border-width: 5px 5px 0;
            border-style: solid;
            border-color: white transparent transparent;
        }

        .font-serif-tc { font-family: 'Noto Serif TC', serif; }
        .surface { background-color: var(--surface); border: 1px solid rgba(255,255,255,0.05); }
        .done-text { text-decoration: line-through; color: var(--text-muted); opacity: 0.5; }
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 10px; }
    </style>
</head>
<body class="p-4 pb-10">

    <div class="max-w-md mx-auto space-y-6">
        <header class="flex justify-between items-center py-2">
            <h1 class="text-2xl font-black tracking-tighter" style="color: var(--primary)">DASHBOARD.exe</h1>
            <div class="flex gap-2">
                <button onclick="resetToken()" class="text-[9px] opacity-30 hover:opacity-100 border border-white/20 px-2 py-0.5 rounded">RESET KEY</button>
                <div id="status" class="text-[10px] uppercase tracking-widest px-2 py-1 rounded bg-white/5 text-muted">Initializing...</div>
            </div>
        </header>

        <section class="surface rounded-3xl p-6 shadow-2xl relative overflow-hidden min-h-[140px] flex flex-col justify-center">
            <div id="lyric-content" class="relative z-10"></div>
            <div id="video-container" class="hidden mt-4 overflow-hidden rounded-xl bg-black aspect-video relative z-10"></div>
            <div class="absolute -top-10 -right-10 w-32 h-32 blur-[80px]" style="background: var(--primary); opacity: 0.2;"></div>
        </section>

        <div class="surface p-5 rounded-3xl shadow-xl">
            <input id="mainInput" type="text" placeholder="Input command..." 
                class="w-full bg-black/40 text-white placeholder-slate-600 p-4 rounded-2xl outline-none focus:ring-1 focus:ring-purple-500 mb-4">
            <div class="grid grid-cols-3 gap-2">
                <button onclick="togglePriority()" class="py-3 rounded-xl text-xs font-bold transition-all active:scale-95" style="background: var(--primary)">Ôºã TASK</button>
                <button onclick="addItem('idea')" class="py-3 rounded-xl text-xs font-bold opacity-80" style="background: var(--surface); border: 1px solid var(--primary)">IDEA</button>
                <button onclick="addItem('buy')" class="py-3 rounded-xl text-xs font-bold opacity-80" style="background: var(--surface); border: 1px solid var(--primary)">BUY</button>
            </div>
            <div id="priorityGroup" class="hidden grid grid-cols-3 gap-2 mt-4 pt-4 border-t border-white/5">
                <button onclick="addTodo(1)" class="py-2 rounded-lg text-[10px] font-bold border border-red-500/50 text-red-400">CRITICAL</button>
                <button onclick="addTodo(2)" class="py-2 rounded-lg text-[10px] font-bold border border-yellow-500/50 text-yellow-400">NORMAL</button>
                <button onclick="addTodo(3)" class="py-2 rounded-lg text-[10px] font-bold border border-green-500/50 text-green-400">LOW</button>
            </div>
        </div>

        <main class="space-y-8">
            <section>
                <div class="flex justify-between items-center mb-3 px-2">
                    <h2 class="text-[10px] font-bold tracking-widest uppercase" style="color: var(--accent-blue)">üìù To-Do / Priority</h2>
                    <button onclick="clearCompleted('todo')" class="text-[10px] opacity-50 hover:opacity-100">CLEAN DONE</button>
                </div>
                <ul id="todoList" class="space-y-2"></ul>
            </section>
            <section>
                <h2 class="text-[10px] font-bold tracking-widest uppercase mb-3 px-2" style="color: var(--accent-pink)">üí° Brainstorm</h2>
                <ul id="ideaList" class="space-y-2"></ul>
            </section>
            <section>
                <h2 class="text-[10px] font-bold tracking-widest uppercase mb-3 px-2" style="color: var(--accent-yellow)">üõí Shopping</h2>
                <ul id="buyList" class="space-y-2"></ul>
            </section>
        </main>
    </div>

    <div id="pixel-cat" onclick="meow()"></div>
    <div id="cat-bubble">MEOW!</div>

    <script>
        const CONFIG = {
            LYRICS_URL: 'https://raw.githubusercontent.com/mistyflow66/yc-daily/refs/heads/main/lyrics.json'
        };

        let db = { todo: [], idea: [], buy: [] };
        let lyricsDB = [];
        let currentLyric = null;

        // Ë≤ìÂí™ÈÇèËºØËÆäÊï∏ - ÂàùÂßã‰ΩçÁΩÆÊîπÁÇ∫‰∏≠Èñì
        let catX = window.innerWidth / 2;
        let catTargetX = catX;
        let isWalking = true;

        function getToken() {
            let token = localStorage.getItem('GIST_TOKEN');
            if (!token) {
                token = prompt("Ë´ãËº∏ÂÖ•ÊÇ®ÁöÑ GitHub Personal Access Token (ghp_...):");
                if (token) localStorage.setItem('GIST_TOKEN', token);
            }
            return token;
        }

        function getGistId() {
            let id = localStorage.getItem('GIST_ID_KEY');
            if (!id) {
                id = prompt("Ë´ãËº∏ÂÖ•ÊÇ®ÁöÑ Gist ID (Á∂≤ÂùÄÊúÄÂæåÈÇ£‰∏Ä‰∏≤‰∫ÇÁ¢º):");
                if (id) localStorage.setItem('GIST_ID_KEY', id);
            }
            return id;
        }

        function resetToken() {
            localStorage.removeItem('GIST_TOKEN');
            localStorage.removeItem('GIST_ID_KEY');
            localStorage.removeItem('LYRIC_CACHE');
            localStorage.removeItem('LYRIC_UPDATE_TIME');
            location.reload();
        }

        async function init() {
            updateStatus('Initializing...');
            const token = getToken();
            const gistId = getGistId();

            if (!token || !gistId) {
                updateStatus('Setup Required');
                return;
            }

            try {
                const lastLyricUpdate = localStorage.getItem('LYRIC_UPDATE_TIME');
                const cachedLyrics = localStorage.getItem('LYRIC_CACHE');
                const now = new Date().getTime();
                const oneDay = 24 * 60 * 60 * 1000; 

                if (cachedLyrics && lastLyricUpdate && (now - lastLyricUpdate < oneDay)) {
                    lyricsDB = JSON.parse(cachedLyrics);
                } else {
                    updateStatus('Updating Lyrics...');
                    const lyricRes = await fetch(CONFIG.LYRICS_URL);
                    lyricsDB = await lyricRes.json();
                    localStorage.setItem('LYRIC_CACHE', JSON.stringify(lyricsDB));
                    localStorage.setItem('LYRIC_UPDATE_TIME', now.toString());
                }

                updateStatus('Syncing Cloud...');
                const gistRes = await fetch(`https://api.github.com/gists/${gistId}`, {
                    headers: { Authorization: `token ${token}` }
                });

                if (gistRes.status === 401) { alert("Token ÁÑ°Êïà„ÄÇ"); return; }
                else if (gistRes.status === 404) { alert("Êâæ‰∏çÂà∞ Gist ID„ÄÇ"); return; }

                const gistData = await gistRes.json();
                db = JSON.parse(gistData.files['dashboard.json'].content);

                renderAll();
                refreshLyric();
                updateStatus('System Online');
                
                // ÂïüÂãïË≤ìÂí™
                moveCat();
            } catch (e) {
                updateStatus('Sync Error');
                console.error(e);
            }
        }

        // Ë≤ìÂí™ÁßªÂãïÈÇèËºØ
        function moveCat() {
            const cat = document.getElementById('pixel-cat');
            const bubble = document.getElementById('cat-bubble');
            if(!cat || !bubble) return;

            const screenWidth = window.innerWidth;

            if (isWalking) {
                if (Math.abs(catX - catTargetX) < 2) {
                    isWalking = false;
                    setTimeout(() => {
                        catTargetX = Math.random() * (screenWidth - 40);
                        isWalking = true;
                        cat.style.transform = catTargetX > catX ? 'scaleX(-1)' : 'scaleX(1)';
                    }, Math.random() * 5000 + 2000);
                } else {
                    catX += (catTargetX > catX ? 1 : -1) * 0.5;
                    cat.style.left = catX + 'px';
                    bubble.style.left = (catX - 10) + 'px';
                }
            }
            requestAnimationFrame(moveCat);
        }

        function meow() {
            const bubble = document.getElementById('cat-bubble');
            const messages = ["MEOW!", "ÂñµÁöÑÂíßÔΩû", "oh oh oh oh...", "ÊàëÂè™Ë¶ÅÂè™Â±¨ÊñºÊàëÁöÑÂÆáÂÆô‚ô™", "ÊÉ≥Áù°Ë¶∫...", "ÁΩêÈ†≠Ôºü"];
            bubble.innerText = messages[Math.floor(Math.random() * messages.length)];
            bubble.style.display = 'block';
            setTimeout(() => bubble.style.display = 'none', 2000);
            const cat = document.getElementById('pixel-cat');
            cat.style.bottom = '25px';
            setTimeout(() => cat.style.bottom = '10px', 200);
        }

        async function syncCloud() {
            const token = getToken();
            const gistId = getGistId();
            if (!token || !gistId) return;
            updateStatus('Syncing...');
            try {
                const res = await fetch(`https://api.github.com/gists/${gistId}`, {
                    method: 'PATCH',
                    headers: { Authorization: `token ${token}` },
                    body: JSON.stringify({
                        files: { 'dashboard.json': { content: JSON.stringify(db) } }
                    })
                });
                if (res.ok) updateStatus('System Online');
            } catch (e) { updateStatus('Sync Error'); }
        }

        function renderList(type) {
            const list = document.getElementById(type + 'List');
            if (!list) return;
            const items = db[type] || [];
            const colors = { 1: 'var(--secondary)', 2: 'var(--accent-yellow)', 3: 'var(--accent-green)' };

            list.innerHTML = items.map(item => `
                <li class="surface p-4 rounded-2xl flex justify-between items-center group animate-in fade-in duration-500">
                    <div class="flex items-center gap-3 flex-1 cursor-pointer" onclick="toggleDone('${type}', ${item.id})">
                        <div class="w-2 h-2 rounded-full" style="background: ${type==='todo' ? colors[item.level] : 'var(--primary)'}; box-shadow: 0 0 10px ${type==='todo' ? colors[item.level] : 'var(--primary)'}66"></div>
                        <span class="text-sm ${item.done ? 'done-text' : ''}">${item.text}</span>
                    </div>
                    <button onclick="deleteItem('${type}', ${item.id})" class="opacity-0 group-hover:opacity-100 text-xs text-slate-500 hover:text-white">‚úï</button>
                </li>
            `).join('');
        }

        function refreshLyric() {
            if (!lyricsDB.length) return;
            currentLyric = lyricsDB[Math.floor(Math.random() * lyricsDB.length)];
            const isEnglish = !/[\u4e00-\u9fa5]/.test(currentLyric.quote);
            const openQ = isEnglish ? '‚Äú' : '„Äå';
            const closeQ = isEnglish ? '‚Äù' : '„Äç';
            document.getElementById('lyric-content').innerHTML = `
                <div class="font-serif-tc text-lg mb-3 italic">${openQ}${currentLyric.quote}${closeQ}</div>
                <div class="flex justify-between items-center">
                    <span class="text-[10px] uppercase tracking-widest" style="color: var(--text-muted)">// ${currentLyric.title}</span>
                    <button onclick="toggleVideo()" class="text-[10px] font-bold" style="color: var(--accent-green)">DISPLAY_FULL</button>
                </div>
            `;
            document.getElementById('video-container').classList.add('hidden');
        }

        function toggleVideo() {
            const v = document.getElementById('video-container');
            if (v.classList.contains('hidden')) {
                v.innerHTML = `<iframe width="100%" height="100%" src="https://www.youtube.com/embed/${currentLyric.ytId}?autoplay=1" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
                v.classList.remove('hidden');
            } else { v.classList.add('hidden'); v.innerHTML = ''; }
        }

        function togglePriority() { document.getElementById('priorityGroup').classList.toggle('hidden'); }
        async function addTodo(level) {
            const text = document.getElementById('mainInput').value;
            if(!text) return;
            db.todo.push({ id: Date.now(), text, level, done: false });
            db.todo.sort((a,b) => a.level - b.level);
            await finalizeAction();
        }
        async function addItem(type) {
            const text = document.getElementById('mainInput').value;
            if(!text) return;
            db[type].push({ id: Date.now(), text, done: false });
            await finalizeAction();
        }
        async function toggleDone(type, id) {
            db[type] = db[type].map(i => i.id === id ? {...i, done: !i.done} : i);
            renderList(type);
            await syncCloud();
        }
        async function deleteItem(type, id) {
            db[type] = db[type].filter(i => i.id !== id);
            renderAll();
            await syncCloud();
        }

        async function clearCompleted() {
            const types = ['todo', 'idea', 'buy'];
            types.forEach(type => {
                if (db[type]) {
                    db[type] = db[type].filter(i => !i.done);
                }
            });
            renderAll();
            await syncCloud();
            updateStatus('All Cleared');
            setTimeout(() => updateStatus('System Online'), 2000);
        }

        async function finalizeAction() {
            document.getElementById('mainInput').value = '';
            document.getElementById('priorityGroup').classList.add('hidden');
            renderAll();
            refreshLyric();
            await syncCloud();
        }

        function renderAll() { ['todo', 'idea', 'buy'].forEach(renderList); }
        function updateStatus(txt) { document.getElementById('status').innerText = txt; }

        init();
    </script>
</body>
</html>
